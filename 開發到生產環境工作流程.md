# 🚀 小汪記記開發到生產環境工作流程

## 📝 完整工作流程

### **階段 1: 開發環境開發** 
```bash
# 1. 切換到開發環境
npm run env:dev

# 2. 啟動開發服務器
npm run dev

# 3. 使用 ngrok 暴露本地服務器
ngrok http 3003

# 4. 在測試 LINE Bot 中測試功能
# - 訊息接收
# - 資料庫記錄
# - 新功能驗證
```

### **階段 2: 開發完成後提交**
```bash
# 1. 檢查修改內容
git status
git diff

# 2. 添加改動到暫存區
git add .

# 3. 提交到開發分支
git commit -m "添加新功能: [功能描述]

🤖 Generated with Claude Code"

# 4. 推送到 GitHub
git push origin develop
```

### **階段 3: 生產環境部署準備**
```bash
# 1. 切換到生產分支
git checkout master

# 2. 合併開發分支
git merge develop

# 3. 切換到生產環境配置
npm run env:prod

# 4. 測試生產配置（本地）
npm start
```

### **階段 4: 部署選擇**

#### **選項 A: 部署到 Zeabur**
```bash
# 1. 推送到 GitHub master
git push origin master

# 2. 在 Zeabur 觸發自動部署
# - GitHub integration 會自動檢測 master 分支變更
# - 自動構建和部署

# 3. 更新生產環境 LINE Bot Webhook
# 設定為: https://你的zeabur域名.zeabur.app/webhook
```

#### **選項 B: 僅本地生產測試**
```bash
# 1. 使用生產環境配置本地運行
npm run env:prod
npm start

# 2. 使用 ngrok 暴露
ngrok http 3000

# 3. 臨時更新生產 LINE Bot Webhook
# 設定為: https://你的ngrok域名.ngrok.io/webhook
```

---

## ⚙️ 環境管理命令

| 命令 | 作用 |
|------|------|
| `npm run env:dev` | 切換到開發環境 |
| `npm run env:prod` | 切換到生產環境 |
| `npm run dev` | 開發模式啟動 |
| `npm start` | 生產模式啟動 |

---

## 🔧 環境配置差異

### **開發環境特徵**：
- ✅ 使用測試 LINE Bot Token
- ✅ 資料庫表格前綴 `dev_`
- ✅ 本地端口 3003 
- ✅ ngrok 暴露 Webhook
- ✅ 詳細日誌輸出

### **生產環境特徵**：
- ✅ 使用正式 LINE Bot Token
- ✅ 資料庫表格無前綴 (`messages`)
- ✅ Zeabur 自動端口
- ✅ 正式域名 Webhook
- ✅ 優化日誌輸出

---

## 🚨 重要注意事項

### **安全性**：
- ❌ 絕對不要提交 `.env.production` 到 Git
- ❌ 不要在開發環境使用生產 Token
- ✅ 定期更新測試環境密鑰

### **資料庫隔離**：
- 開發: `dev_messages` 表格
- 生產: `messages` 表格
- 完全隔離，互不影響

### **版本控制**：
- `develop` 分支: 開發中功能
- `master` 分支: 穩定生產版本
- 合併前必須完整測試

---

## 📞 緊急回滾流程

如果生產環境出現問題：

```bash
# 1. 立即切換到上個穩定版本
git checkout HEAD~1

# 2. 強制推送（謹慎使用）
git push --force origin master

# 3. 重新部署到 Zeabur
# Zeabur 會自動檢測並部署上個版本
```

---

**🎯 現在你可以放心地在開發環境進行所有實驗，確認無誤後一鍵推送到生產環境！**