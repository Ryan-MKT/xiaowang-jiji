# ğŸ¯ å°æ±ªè¨˜è¨˜ Oen Payment æœ€çµ‚æ•´åˆç‹€æ…‹

## âœ… **å·²ç¢ºèªé…ç½®**

### æ ¸å¿ƒé…ç½®
- **Merchant ID**: `mktersalon` âœ… (ç”¨æˆ¶ç¢ºèª)
- **JWT Token**: çœŸå¯¦ token âœ…
- **API Base**: `https://payment-api.development.oen.tw` âœ…
- **ç³»çµ±æ•´åˆ**: å®Œæˆ âœ…

## ğŸ”§ **æŠ€è¡“å¯¦ç¾å®Œæˆåº¦**

### âœ… **å·²å®ŒæˆåŠŸèƒ½**
1. **æ”¯ä»˜è¨‚å–®å‰µå»º**
   - API endpoint: `/checkout-onetime`
   - åƒæ•¸æ ¼å¼ç¬¦åˆå®˜æ–¹è¦ç¯„
   - Bearer èªè­‰å¯¦ç¾

2. **äº¤æ˜“æŸ¥è©¢**
   - API endpoint: `/order/{orderId}/transactions`
   - å›æ‡‰è§£æå®Œæ•´

3. **é€€æ¬¾åŠŸèƒ½**
   - API endpoint: `/refunds/{transactionHid}`
   - æ”¯æ´å•†å“è©³ç´°å’Œé€€æ¬¾å¸³æˆ¶

4. **è¨‚é–±å–æ¶ˆ**
   - API endpoint: `/subscriptions/{subscriptionId}`
   - å–æ¶ˆåŸå› è¨˜éŒ„

5. **ç³»çµ±æ•´åˆ**
   - `server.js` ä½¿ç”¨ `payment-correct.js`
   - ç’°å¢ƒè®Šæ•¸é…ç½®å®Œæˆ
   - éŒ¯èª¤è™•ç†å®Œæ•´

## ğŸ§ª **æ¸¬è©¦ç‹€æ…‹**

### ç•¶å‰å•é¡Œ
```
âŒ æ‰€æœ‰ API endpoints å›æ‡‰ 404
```

### å¯èƒ½åŸå› åˆ†æ
1. **API Version è·¯å¾‘å•é¡Œ**
   - å¯èƒ½éœ€è¦ `/v1/` å‰ç¶´
   - æˆ– `/api/` å‰ç¶´

2. **é–‹ç™¼ç’°å¢ƒ vs æ¸¬è©¦ç’°å¢ƒ**
   - JWT audience æŒ‡å‘ `development`
   - ä½†æ–‡æª”æåˆ° `testing`

3. **API é‚„æœªå•Ÿç”¨**
   - æ–°ç”³è«‹çš„ merchant å¯èƒ½éœ€è¦å•Ÿç”¨

## ğŸ¯ **ç«‹å³å¯åŸ·è¡Œæ¸¬è©¦**

ä¸€æ—¦ API endpoints ç¢ºèªå¯ç”¨ï¼Œæˆ‘å€‘å¯ä»¥ç«‹å³æ¸¬è©¦ï¼š

### 1. åŸºæœ¬æ”¯ä»˜æµç¨‹
```javascript
// å‰µå»º 299 å…ƒè¨‚å–®
POST /api/payment/create
{
  "userId": "real_line_user_id",
  "amount": 299,
  "itemName": "å°æ±ªè¨˜è¨˜ Premium è¨‚é–±"
}
```

### 2. å®Œæ•´ç”¨æˆ¶æµç¨‹
```
LINE Bot â†’ LIFF å¸³æˆ¶é  â†’ é»æ“Šå‡ç´š â†’ æ”¯ä»˜é é¢ â†’ å®Œæˆæ”¯ä»˜ â†’ è‡ªå‹•é€šçŸ¥ â†’ è¨‚é–±å•Ÿç”¨
```

## ğŸ“‹ **éœ€è¦å®˜æ–¹ç¢ºèªçš„é …ç›®**

### 1. API Endpoints
- [ ] ç¢ºèªæ­£ç¢ºçš„ base URL
- [ ] æ˜¯å¦éœ€è¦ç‰ˆæœ¬è™Ÿ (v1, v2)
- [ ] é–‹ç™¼ç’°å¢ƒ vs æ¸¬è©¦ç’°å¢ƒä½¿ç”¨

### 2. JWT Token æ¬Šé™
- [ ] ç•¶å‰ token æ˜¯å¦æœ‰å»ºç«‹è¨‚å–®æ¬Šé™
- [ ] æ¬Šé™ç¯„åœç¢ºèª

### 3. Webhook è¨­å®š
- [ ] æ”¯ä»˜æˆåŠŸ/å¤±æ•—å›èª¿ URL é…ç½®
- [ ] Webhook æ ¼å¼å’Œç°½ç« é©—è­‰

## ğŸš€ **éƒ¨ç½²å°±ç·’æª¢æŸ¥**

### âœ… å·²æº–å‚™å®Œæˆ
- [x] å®Œæ•´ API å¯¦ç¾
- [x] çœŸå¯¦ merchant ID
- [x] çœŸå¯¦ JWT token
- [x] ç³»çµ±æ•´åˆå®Œæˆ
- [x] éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- [x] æ¸¬è©¦æ¡†æ¶å»ºç«‹
- [x] LINE Bot é€šçŸ¥ç³»çµ±
- [x] LIFF ä»‹é¢æ•´åˆ
- [x] Supabase è³‡æ–™åº«åŒæ­¥

### â³ ç­‰å¾…ç¢ºèª
- [ ] API endpoints å¯ç”¨æ€§
- [ ] Webhook é…ç½®

## ğŸ’¡ **å»ºè­°å¾ŒçºŒæ­¥é©Ÿ**

### ç«‹å³è¡Œå‹•
1. **è¯çµ¡ Oen Payment æŠ€è¡“æ”¯æ´**
   - æä¾› merchant ID: `mktersalon`
   - ç¢ºèª API endpoints
   - é©—è­‰ token æ¬Šé™

2. **ä¸€æ—¦ç¢ºèª endpoints**
   - åŸ·è¡Œ `node test-payment-correct.js`
   - æ¸¬è©¦å®Œæ•´æ”¯ä»˜æµç¨‹
   - é©—è­‰ webhook å›èª¿

### é æœŸçµæœ
- çœŸå¯¦æ”¯ä»˜åŠŸèƒ½å•Ÿç”¨
- ç”¨æˆ¶å¯ä»¥å¯¦éš›ä»˜æ¬¾å‡ç´š
- ç³»çµ±è‡ªå‹•è™•ç†è¨‚é–±æ›´æ–°

---

**ç‹€æ…‹**: ğŸŸ¡ **æŠ€è¡“æº–å‚™å®Œæˆï¼Œç­‰å¾… API ç¢ºèª**  
**æœ€å¾Œæ›´æ–°**: 2025-09-12  
**ç³»çµ±æ•´åˆåº¦**: 95% (åªå·® API endpoints ç¢ºèª)