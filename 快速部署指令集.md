# 🚀 快速部署指令集

## 立即執行：一鍵部署指令

### 選項 A：Render 部署（推薦）
```bash
# 1. 先提交程式碼到 GitHub
git add .
git commit -m "feat: 新增 LINE Login 功能"
git push origin master

# 2. 前往 Render Dashboard
# https://dashboard.render.com/

# 3. 點擊 New > Web Service
# 4. 連接您的 GitHub 儲存庫
# 5. 填寫以下資訊：
#    Name: xiaowang-jiji
#    Environment: Node
#    Build Command: npm install
#    Start Command: node server.js
```

### 選項 B：Zeabur 部署
```bash
# 1. 提交程式碼
git add .
git commit -m "feat: 新增 LINE Login 功能"
git push

# 2. 前往 Zeabur
# https://zeabur.com/

# 3. 建立專案並連接 Git
# 4. 自動部署開始
```

### 選項 C：Railway 部署
```bash
# 1. 安裝 Railway CLI
npm install -g @railway/cli

# 2. 登入並部署
railway login
railway init
railway up

# 3. 設定環境變數
railway variables set LINE_LOGIN_CHANNEL_ID=您的ID
railway variables set LINE_LOGIN_CHANNEL_SECRET=您的Secret
railway variables set SESSION_SECRET=$(openssl rand -hex 32)
```

---

## 🔧 環境變數快速設定

### 生成隨機 Session Secret
```bash
# 方法 1：Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# 方法 2：OpenSSL
openssl rand -hex 32

# 方法 3：PowerShell
-join ((65..90) + (97..122) + (48..57) | Get-Random -Count 32 | % {[char]$_})
```

### 批次設定環境變數（複製貼上用）
```bash
LINE_CHANNEL_ACCESS_TOKEN=
LINE_CHANNEL_SECRET=
LINE_LOGIN_CHANNEL_ID=
LINE_LOGIN_CHANNEL_SECRET=
LINE_LOGIN_REDIRECT_URI=https://您的域名/auth/line/callback
SESSION_SECRET=
SUPABASE_URL=
SUPABASE_ANON_KEY=
```

---

## 📋 LINE Developers Console 快速設定

### 1. 快速建立 Channel
```
1. 開啟：https://developers.line.biz/console/
2. 點擊：Create a new channel
3. 選擇：LINE Login
4. 填寫：
   - Channel name: 小汪記記 Web
   - Channel description: Web Login
   - App types: Web app
5. 點擊：Create
```

### 2. 快速取得認證資訊
```
1. 進入 Channel 基本設定
2. 複製 Channel ID
3. 點擊 Show 顯示 Channel secret
4. 複製 Channel secret
```

### 3. 快速設定 Callback URL
```
本地測試：
http://localhost:3000/auth/line/callback

生產環境（根據平台選擇）：
https://xiaowang-jiji.onrender.com/auth/line/callback
https://xiaowang-jiji.zeabur.app/auth/line/callback
https://xiaowang-jiji.railway.app/auth/line/callback
https://您的自訂域名.com/auth/line/callback
```

---

## 🧪 快速測試指令

### 本地測試
```bash
# 1. 安裝並啟動
cd 小汪記記
npm install
node server.js

# 2. 測試端點
curl http://localhost:3000/health
curl http://localhost:3000/auth/line/status

# 3. 開啟瀏覽器
start http://localhost:3000
```

### 生產環境測試
```bash
# 健康檢查
curl https://您的域名/health

# 登入狀態
curl https://您的域名/auth/line/status

# Bot Webhook 測試
curl -X POST https://您的域名/webhook \
  -H "Content-Type: application/json" \
  -d '{"events":[]}'
```

---

## 🔥 緊急修復指令

### 如果登入失敗
```bash
# 1. 檢查環境變數
node -e "console.log(process.env.LINE_LOGIN_CHANNEL_ID)"

# 2. 重新設定
export LINE_LOGIN_CHANNEL_ID=您的ID
export LINE_LOGIN_CHANNEL_SECRET=您的Secret

# 3. 重啟服務
npm start
```

### 如果 Session 有問題
```bash
# 生成新的 Session Secret
export SESSION_SECRET=$(node -e "console.log(require('crypto').randomBytes(32).toString('hex'))")

# 重啟服務
npm start
```

---

## 📊 監控指令

### 查看日誌
```bash
# Render
# 在 Dashboard 查看 Logs

# Railway
railway logs

# PM2（如果使用）
pm2 logs

# Docker（如果使用）
docker logs container-name
```

### 健康檢查腳本
```bash
#!/bin/bash
# health-check.sh
URL="https://您的域名"

echo "檢查服務狀態..."
curl -f $URL/health || echo "❌ 服務異常"
curl -f $URL/auth/line/status || echo "❌ LINE Login 異常"
echo "✅ 檢查完成"
```

---

## 🎯 30 秒快速部署

如果您很趕時間，執行這些：

```bash
# 1. 提交程式碼（10秒）
git add . && git commit -m "部署" && git push

# 2. 開啟 Render（10秒）
# https://dashboard.render.com/
# New > Web Service > 選擇 repo

# 3. 貼上環境變數（10秒）
# 從 .env.production 複製貼上

# 完成！等待部署（3-5分鐘）
```

---

## Linus 的部署哲學

"部署不是結束，是開始。"

三個原則：
1. **簡單部署**：越簡單越不容易出錯
2. **快速回滾**：隨時準備退回上一版
3. **持續監控**：部署後的 24 小時最關鍵

"記住：生產環境的 bug 才是真正的 bug。"